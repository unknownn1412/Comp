<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="stylesheet" href="Calculator.css">
<title>Materi compunding</title>
<style>
  :root{ --bg1: linear-gradient(135deg,#667eea,#764ba2); --glass: rgba(255,255,255,0.10); --accent1: #00c6ff; --accent2: #0072ff; --text: #f5f7fb; --muted: rgba(245,247,251,0.82); }
  [data-theme="dark"]{ --glass: rgba(0,0,0,0.35); --bg1: linear-gradient(135deg,#071027,#0b1220); --text:#e6eef8; --muted: rgba(230,238,248,0.85); }
  *{box-sizing:border-box;font-family:Inter,'Poppins',system-ui,-apple-system,sans-serif}
  html,body{height:100%;margin:0}
  body{min-height:100vh;display:flex;flex-direction:column;align-items:center;gap:18px;padding:22px;background:var(--bg1);color:var(--text);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}

  /* header (TIDAK DIUBAH) */
  .site-header{width:100%;max-width:1180px;display:flex;align-items:center;gap:12px;padding:12px 18px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 8px 24px rgba(2,6,23,0.18);border:1px solid rgba(255,255,255,0.03);backdrop-filter: blur(6px)}
  .brand .title{font-weight:800}
  .brand .sub{font-size:.78rem;color:var(--muted)}
  .header-actions{margin-left:auto;display:flex;align-items:center;gap:10px}

  /* ===== menu / hamburger (replacements) ===== */
  .menu-btn{
    background:transparent;
    border:none;
    padding:8px;
    border-radius:10px;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    position:relative;
    z-index:1300;
  }
  .hamburger{ width:28px; height:20px; position:relative; display:inline-block; -webkit-tap-highlight-color: transparent; }
  .hamburger span{ position:absolute; left:0; right:0; height:2.5px; background:linear-gradient(90deg,var(--accent1),var(--accent2)); border-radius:3px; transition:transform .28s cubic-bezier(.2,.9,.3,1), opacity .18s, top .18s; will-change:transform, opacity, top; }
  .hamburger span:nth-child(1){ top:0; }
  .hamburger span:nth-child(2){ top:9px; }
  .hamburger span:nth-child(3){ top:18px; }
  .menu-btn.open .hamburger span:nth-child(1){ transform: translateY(9px) rotate(45deg); top:9px; }
  .menu-btn.open .hamburger span:nth-child(2){ opacity:0; transform: scaleX(0.2); top:9px; }
  .menu-btn.open .hamburger span:nth-child(3){ transform: translateY(-9px) rotate(-45deg); top:9px; }

  .side-menu{ position:fixed; top:0; left:0; height:100vh; width:360px; max-width:85vw; background:var(--glass); backdrop-filter:blur(12px); box-shadow:0 30px 60px rgba(2,6,23,0.45); transform:translateX(-110%); transition:transform .28s cubic-bezier(.2,.9,.3,1); z-index:1200; padding:22px; overflow:auto; -webkit-overflow-scrolling:touch; }
  .side-menu.open{ transform:translateX(0); }

  .menu-overlay{ position:fixed; inset:0; background: rgba(0,0,0,0.35); z-index:1100; opacity:0; pointer-events:none; transition:opacity .22s ease; }
  .menu-overlay.show{ opacity:1; pointer-events:auto; }

  .menu-list a, .collapsible { display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; text-decoration:none; color:var(--text); font-weight:700; transition:transform .12s ease, background .12s ease, box-shadow .12s ease; position:relative; overflow:visible; }
  .menu-list a:focus, .collapsible:focus { outline:2px solid rgba(0,198,255,0.14); outline-offset:3px; }
  .menu-list a::after, .collapsible::after{ content:''; position:absolute; left:10px; right:10px; height:4px; border-radius:6px; background:linear-gradient(90deg,var(--accent1),var(--accent2)); transform:scaleX(0); transform-origin:left; transition:transform .28s cubic-bezier(.2,.9,.3,1),opacity .18s; opacity:0 }
  .menu-list a:hover, .collapsible:hover{ transform:translateX(6px); box-shadow:0 8px 20px rgba(0,0,0,0.10) }
  .menu-list a:hover::after, .collapsible:hover::after{ transform:scaleX(1); opacity:1 }
  .close-menu { color:var(--text); background:transparent; border:none; font-size:26px; cursor:pointer; }
  @media (max-width:420px){ .side-menu{ width:85vw; } .hamburger{ width:24px; height:18px; } }

  /* --- IMPORTANT: force vertical stacking (no side-by-side) --- */
  .card{width:100%;max-width:1180px;border-radius:18px;padding:18px;background:var(--glass);backdrop-filter: blur(10px);box-shadow:0 18px 40px rgba(2,6,23,0.35);display:grid;grid-template-columns:1fr;grid-auto-rows:auto;gap:18px;position:relative;overflow:visible}
  @media (max-width:980px){ .card{padding:14px} }
  .card::before{ content:'';position:absolute;left:-40px;top:-40px;width:200px;height:200px;border-radius:50%;background:radial-gradient(circle at 20% 20%, rgba(0,198,255,0.12), transparent 30%);pointer-events:none;mix-blend-mode:screen;filter:blur(18px);opacity:.9}

  .lesson-content{padding:8px 6px}
  .lesson-content h1{margin:0 0 6px;font-size:1.18rem}
  .lesson-content h2{margin:10px 0 6px;font-size:1.04rem}
  .lesson-content h3{margin:12px 0 6px;font-size:1rem}
  .formula-box{background:linear-gradient(180deg, rgba(0,0,0,0.06), rgba(0,0,0,0.04));padding:12px;border-radius:10px;font-weight:700}
  .muted{color:var(--muted);font-size:.95rem}
  .example{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px}
  table.compound-table{width:100%;border-collapse:collapse;margin-top:8px}
  table.compound-table th, table.compound-table td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.04);text-align:right;font-size:0.95rem}
  table.compound-table th:first-child, table.compound-table td:first-child{text-align:left}

  .btn{margin-top:14px;padding:10px 12px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;font-weight:700;cursor:pointer;width:100%;box-shadow:0 10px 30px rgba(7,130,255,0.12);position:relative;overflow:hidden}
  .note{font-size:0.92rem;color:var(--muted);margin-top:8px}

  /* small helpers */
  .kbd{background:rgba(255,255,255,0.03);padding:2px 6px;border-radius:6px;font-weight:700}
  .toc{font-size:0.95rem;margin-bottom:8px}
  .qa{margin-top:10px}
  .answer{background:linear-gradient(180deg, rgba(0,0,0,0.03), rgba(0,0,0,0.02));padding:10px;border-radius:8px;margin-top:6px}
</style>
</head>
<body data-theme="light">

<header class="site-header" role="banner" aria-label="Compounding header">
  <button id="menuBtn" class="menu-btn" aria-label="Buka menu" aria-controls="sideMenu" aria-expanded="false">
    <span class="hamburger" aria-hidden="true"><span></span><span></span><span></span></span>
  </button>
  <div class="brand" style="margin-left:6px">
    <div class="title" style="font: size 10px">Materi compunding</div>
    <div class="sub">Pengertian, rumus, contoh langkah demi langkah, dan tips praktis</div>
  </div>
  <div class="header-actions" role="toolbar" aria-label="Aksi header">
    <label for="themeToggle" style="font-size:.78rem;color:var(--muted);margin-right:8px">Mode</label>
    <select id="themeToggle" class="input-read" aria-label="Toggle tema" style="width:120px">
      <option value="light">Ringan</option><option value="dark">Gelap</option>
    </select>
  </div>
</header>

<nav id="sideMenu" class="side-menu" aria-hidden="true">
  <button id="closeMenu" class="close-menu" aria-label="Tutup menu" style="position:absolute;right:12px;top:8px;background:transparent;border:none;font-size:26px;color:var(--text)">×</button>
  <ul class="menu-list" role="menu" aria-label="Menu">
    <li role="none"><a href="Calculator.html" id="navCalculator" data-nav="calculator" role="menuitem" tabindex="0">Calculator</a></li>
    <li role="none">
      <button class="collapsible" aria-expanded="false" style="background:transparent;border:none;padding:0">Pembelajaran</button>
      <ul class="sublist" aria-label="Kumpulan video YouTube" role="menu">
        <li><a href="Bunga2.html" class="video-link muted" role="menuitem" tabindex="-1">Materi Compounding</a></li>
        <li><a href="video.html" class="video-link muted" role="menuitem" tabindex="-1"> Pembelajaran Youtube</a></li>
      </ul>
    </li>
    <li role="none"><a href="About.html" id="navAbout">Tentang & Bantuan</a></li>
  </ul>
</nav>
<div id="menuOverlay" class="menu-overlay" hidden></div>

<!-- MAIN CARD: ISI MATERI (SEMUA VERTIKAL) -->
<main class="card" role="main" aria-label="Materi compounding">

  <!-- LEFT (sekarang atas): Penjelasan & Rumus -->
  <section class="lesson-content" aria-label="Penjelasan compounding">
    <h1 style="font-size: 40px">Materi compounding</h1>

    <div class="toc">
      <strong>Daftar isi singkat:</strong>
      <ol style="margin:6px 0 0 18px">
        <li>Pengertian & Intuisi</li>
        <li>Rumus dasar & variasi (periodik / kontinu)</li>
        <li>Konversi suku bunga: nominal ↔ efektif (EAR)</li>
        <li>Setoran berkala (SIP) — rumus nilai masa depan</li>
        <li>Contoh langkah-demi-langkah (beberapa kasus)</li>
        <li>Tabel pertumbuhan & interpretasi</li>
        <li>Tips praktis, kesalahan umum, dan FAQ</li>
      </ol>
    </div>

    <h2>1. Pengertian & Intuisi</h2>
    <p class="muted">Inti: compounding = <strong>bunga atas bunga</strong>. Jika kamu biarkan bunga tidak ditarik, jumlah modal untuk periode berikutnya bertambah sehingga bunga di periode berikutnya dihitung atas jumlah yang lebih besar.</p>
    <p>Contoh visual sederhana: modal Rp 1.000.000 dengan 10% per tahun. Setelah 1 tahun: Rp 1.100.000. Setelah 2 tahun: Rp 1.100.000 × 1.10 = Rp 1.210.000. Kenaikan tahun kedua bukan hanya Rp 100.000 tapi Rp 110.000 — itu efek compounding.</p>

    <h2>2. Rumus dasar & variasi</h2>

    <h3>2.1 Kompaun periodik</h3>
    <div class="formula-box" style="margin-top:6px">
      <div><strong>Rumus:</strong></div>
      <div style="margin-top:6px">A = P × (1 + r / n)^(n t)</div>
      <div class="muted" style="margin-top:6px">
        P = modal awal; r = tingkat tahunan (desimal); n = frekuensi kompaun per tahun; t = waktu (tahun); A = nilai akhir.
      </div>
    </div>

    <h3>2.2 Kompaun kontinu</h3>
    <div class="formula-box" style="margin-top:8px">
      <div><strong>Rumus:</strong> A = P × e^(r t)</div>
      <div class="muted" style="margin-top:6px">Kompaun kontinu didapat dengan mengambil limit n→∞ pada rumus periodik. e = 2.71828...</div>
    </div>

    <h3>2.3 Turunan (intuisi matematis singkat)</h3>
    <p class="muted">Jika bunga tahunan r dibagi ke n periode, tingkat per-periode i = r/n. Setelah n·t periode, faktor pengali = (1 + i)^(n t). Untuk kontinu, limit n→∞ (1 + r/n)^(n t) = e^(r t).</p>

    <h2>3. Nominal rate vs Effective Annual Rate (EAR)</h2>
    <p class="muted">Sering ada istilah 'nominal' (misal 12% pa compounded monthly) dan 'effective' (berapa sebenarnya pertumbuhan setahun penuh).</p>
    <div class="formula-box" style="margin-top:6px">
      <div><strong>EAR dari nominal r dengan n periode:</strong></div>
      <div style="margin-top:6px">EAR = (1 + r/n)^{n} − 1</div>
      <div class="muted" style="margin-top:6px">Contoh: r=12% pa, n=12 → EAR = (1+0.12/12)^{12} − 1 ≈ 0.1268 = 12.68% per tahun efektif.</div>
    </div>

    <h2>4. Setoran berkala (SIP) — nilai masa depan dari anuitas</h2>
    <p class="muted">Jika kamu memasukkan setoran periodik (misal tiap bulan), ada rumus untuk nilai masa depan (future value) dari rangkaian setoran.</p>

    <h3>4.1 Anuitas biasa (setoran di akhir periode)</h3>
    <div class="formula-box" style="margin-top:6px">
      <div><strong>Jika C adalah setoran tiap periode, r_p adalah tingkat per-periode, dan N total periode:</strong></div>
      <div style="margin-top:6px">FV = C × ( (1 + r_p)^{N} − 1 ) / r_p</div>
      <div class="muted" style="margin-top:6px">Jika kontribusi per tahun, r_p = r / n dan N = n t.</div>
    </div>

    <h3>4.2 Anuitas di awal periode (annuity due)</h3>
    <div class="formula-box" style="margin-top:6px">
      <div><strong>Jika setoran di awal:</strong> FV_due = FV_ordinary × (1 + r_p)</div>
      <div class="muted" style="margin-top:6px">Karena tiap setoran mendapat bunga satu periode lebih lama.</div>
    </div>

    <h3>4.3 Kombinasi modal awal + setoran berkala</h3>
    <div class="formula-box" style="margin-top:6px">
      <div><strong>Jumlah akhir total:</strong></div>
      <div style="margin-top:6px">A = P × (1 + r_p)^N + C × ( (1 + r_p)^N − 1 ) / r_p</div>
      <div class="muted" style="margin-top:6px">Jika C ditempatkan di akhir periode. Untuk awal periode, kalikan suku kedua dengan (1 + r_p).</div>
    </div>

    <h2>5. Contoh langkah-demi-langkah (beberapa kasus)</h2>

    <div class="example" style="margin-top:8px">
      <strong>Contoh A — Kompaun periodik sederhana:</strong>
      <div style="margin-top:6px">P = Rp 10.000.000; r = 6% pa; n = 12 (bulanan); t = 5 tahun.</div>
      <ol style="margin:6px 0 0 18px">
        <li>r desimal = 0.06; r_p = r / n = 0.06 / 12 = 0.005</li>
        <li>N = n × t = 12 × 5 = 60</li>
        <li>A = 10.000.000 × (1 + 0.005)^{60} ≈ 10.000.000 × 1.34885 ≈ <strong>Rp 13.488.500</strong></li>
      </ol>
    </div>

    <div class="example" style="margin-top:10px">
      <strong>Contoh B — Setoran berkala (SIP bulanan):</strong>
      <div style="margin-top:6px">P = Rp 0; C = Rp 500.000 per bulan; r = 8% pa; n = 12; t = 10 tahun. Asumsikan setoran di akhir tiap bulan (ordinary annuity).</div>
      <ol style="margin:6px 0 0 18px">
        <li>r_p = 0.08 / 12 ≈ 0.0066666667</li>
        <li>N = 12 × 10 = 120</li>
        <li>FV = C × ( (1 + r_p)^N − 1 ) / r_p</li>
        <li>Hitung (1 + r_p)^N ≈ (1.0066667)^{120} ≈ 2.21964 → FV ≈ 500.000 × (2.21964 − 1) / 0.0066667 ≈ 500.000 × 182.946 ≈ <strong>Rp 91.473.000 (≈)</strong></li>
      </ol>
      <div class="note">Angka dibulatkan untuk ilustrasi; kalkulator akurat akan memberi hasil desimal lebih presisi.</div>
    </div>

    <h2>6. Tabel pertumbuhan: contoh lengkap (annually, P + SIP)</h2>
    <p class="muted">Contoh ringkasan tiap tahun untuk kombinasi P + SIP (bulanan) — di sini disajikan per tahun untuk melihat tren.</p>

    <table class="compound-table" style="margin-top:8px">
      <thead><tr><th>Tahun</th><th>Saldo Akhir (Rp)</th><th>Keterangan</th></tr></thead>
      <tbody>
        <tr><td>0</td><td>10.000.000</td><td>Modal awal</td></tr>
        <tr><td>1</td><td>11.234.567</td><td>(contoh) P + 12×C tumbuh</td></tr>
        <tr><td>2</td><td>12.646.789</td><td>efek bunga atas bunga</td></tr>
        <tr><td>5</td><td>16.230.000</td><td>percepatan pertumbuhan</td></tr>
        <tr><td>10</td><td>26.400.000</td><td>perbedaan besar terlihat di jangka panjang</td></tr>
      </tbody>
    </table>
    <div class="note">Tabel ini bersifat ilustratif; gunakan rumus untuk angka pasti sesuai frekuensi dan nilai input.</div>

    <h2>7. Tips praktis & kesalahan umum</h2>
    <ul style="margin:6px 0 0 18px">
      <li><strong>Mulailah lebih awal:</strong> waktu memperbesar efek compounding lebih daripada sedikit kenaikan suku bunga.</li>
      <li><strong>Perhatikan frekuensi kompaun:</strong> bulanan &gt; triwulan &gt; tahunan — semakin sering, semakin besar hasil (sampai limit kontinu).</li>
      <li><strong>Beda nominal vs efektif:</strong> bank sering menampilkan suku bunga nominal; cek EAR/APE untuk membandingkan.</li>
      <li><strong>Jangan lupakan biaya & pajak:</strong> biaya platform, biaya manajer, pajak final bisa signifikan terhadap hasil bersih.</li>
      <li><strong>SIP lebih aman untuk investor ritel:</strong> mengurangi timing risk lewat rata-rata dollar-cost averaging.</li>
      <li><strong>Inflasi:</strong> gunakan real return = nominal − inflasi untuk menilai daya beli hasil investasi.</li>
    </ul>

    <h2>8. Soal latihan (dengan jawaban singkat)</h2>
    <div class="qa">
      <div><strong>Soal 1:</strong> Kalau P = Rp 5.000.000, r = 10% pa, comp. tahunan, t = 7 tahun → berapa A?</div>
      <div class="answer">Jawab singkat: A = 5.000.000 × (1.10)^7 ≈ 5.000.000 × 1.9487 ≈ <strong>Rp 9.743.500</strong>.</div>

      <div style="margin-top:8px"><strong>Soal 2:</strong> Nominal 12% pa compounded monthly. Berapa EAR?</div>
      <div class="answer">EAR = (1 + 0.12/12)^{12} − 1 ≈ 0.1268 → <strong>12.68% pa</strong>.</div>

      <div style="margin-top:8px"><strong>Soal 3:</strong> Kamu nabung Rp 200.000 per bulan, r = 7% pa, selama 15 tahun. Kasus SIP — apakah lebih menguntungkan dibanding menyimpan Rp 36.000.000 sekali?</div>
      <div class="answer">Umumnya SIP + compounding & reinvestasi > menyimpan sekaligus jika dana ditambahkan bertahap dan dapat memanfaatkan pertumbuhan jangka panjang; hitung dengan rumus anuitas untuk angka pasti.</div>
    </div>

    <h2 style="margin-top:12px">9. Ringkasan rumus penting (cepat)</h2>
    <div class="formula-box" style="margin-top:6px">
      <ul style="margin:0 0 0 18px">
        <li>A = P(1 + r/n)^{n t}</li>
        <li>A (kontinu) = P e^{r t}</li>
        <li>FV annuity (ordinary) = C × ( (1 + r_p)^{N} − 1 ) / r_p</li>
        <li>FV annuity due = FV ordinary × (1 + r_p)</li>
        <li>EAR = (1 + r/n)^{n} − 1</li>
      </ul>
    </div>

  </section>

  <!-- NEW: Pemindahan konten Ringkasan & FAQ ke bawah (tidak lagi di samping) -->
  <section class="quick-summary" style="padding:8px 6px;">
    <div class="formula-box" style="margin-bottom:12px">
      <div style="font-size:1.02rem"><strong>Ringkasan & cepat pakai</strong></div>
      <div style="margin-top:8px" class="muted">Gunakan rumus sesuai skenario: (1) hanya P, (2) P + setoran berkala, (3) setoran berkala tanpa P, atau (4) kompaun kontinu kalau ingin pendekatan limit.</div>
    </div>

    <div class="example" aria-label="Praktik cepat" style="margin-bottom:12px">
      <div style="font-weight:700;margin-bottom:6px">Praktik cepat</div>
      <div style="font-size:.95rem">
        Jika kamu ingin cepat estimasi: <strong>Rule of 72</strong> → tahun ≈ 72 / (suku bunga %).  
        Contoh: 6% → 72 / 6 = <strong>12 tahun</strong> (perkiraan menggandakan modal).
      </div>
    </div>

    <div class="formula-box" style="margin-bottom:12px">
      <div style="font-weight:700">FAQ singkat</div>
      <div style="margin-top:8px" class="muted">
        <strong>Q:</strong> Lebih baik frekuensi bulanan atau tahunan?<br/>
        <strong>A:</strong> Bulanan biasanya memberi hasil sedikit lebih besar; perbedaannya kecil kalau suku rendah tapi lebih terasa pada suku tinggi/jangka panjang.<br/><br/>

        <strong>Q:</strong> Apakah kompaun kontinu realistis?<br/>
        <strong>A:</strong> Secara praktis jarang ada yang benar-benar kontinu, tapi rumusnya berguna untuk batas atas teoretis dan model matematis.<br/><br/>

        <strong>Q:</strong> Mengapa penting hitung EAR?<br/>
        <strong>A:</strong> Untuk membandingkan produk keuangan yang menyebut nominal tapi dengan frekuensi berbeda.
      </div>
    </div>

  </section>
  <div class="card-tip" style="grid-column:1 / -1; margin-top:6px; padding:12px 18px; border-radius:12px; background:transparent; border-top:1px solid rgba(255,255,255,0.06); display:flex; flex-direction:column; align-items:center; gap:8px;">
  </div>
</main>

<!-- Minimal JS: hanya untuk menu, collapsible, dan tema. Tidak ada kode kalkulator atau panel belajar -->
<script>
(function(){
  // Menu & overlay behaviour (robust & accessible)
  const menuBtn = document.getElementById('menuBtn');
  const sideMenu = document.getElementById('sideMenu');
  const menuOverlay = document.getElementById('menuOverlay');
  const closeMenu = document.getElementById('closeMenu');
  const collapsibles = Array.from(document.querySelectorAll('.collapsible'));
  const menuLinks = Array.from(document.querySelectorAll('.menu-list a'));

  function setBodyScroll(disable){ try{ if(disable) document.documentElement.style.overflow = 'hidden'; else document.documentElement.style.overflow = ''; }catch(e){} }

  let focusTrapHandler = null;
  function trapFocus(container){
    const focusable = Array.from(container.querySelectorAll('a,button,input,select,textarea,[tabindex]:not([tabindex="-1"])'))
      .filter(n => !n.hasAttribute('disabled') && n.offsetParent !== null);
    if(!focusable.length) return;
    const first = focusable[0], last = focusable[focusable.length-1];
    focusTrapHandler = function(e){
      if(e.key !== 'Tab') return;
      if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
      else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
    };
    container.addEventListener('keydown', focusTrapHandler);
  }
  function releaseTrap(container){ if(focusTrapHandler) container.removeEventListener('keydown', focusTrapHandler); focusTrapHandler = null; }

  function openMenu(){
    sideMenu.classList.add('open');
    sideMenu.setAttribute('aria-hidden','false');
    menuBtn.classList.add('open');
    menuBtn.setAttribute('aria-expanded','true');
    if(menuOverlay){ menuOverlay.hidden = false; menuOverlay.classList.add('show'); }
    setBodyScroll(true);
    const first = sideMenu.querySelector('a,button'); if(first) first.focus(); trapFocus(sideMenu);
  }

  function closeMenuFn(){
    sideMenu.classList.remove('open');
    sideMenu.setAttribute('aria-hidden','true');
    menuBtn.classList.remove('open');
    menuBtn.setAttribute('aria-expanded','false');
    if(menuOverlay){ menuOverlay.classList.remove('show'); setTimeout(()=>{ if(!menuOverlay.classList.contains('show')) menuOverlay.hidden = true; }, 260); }
    setBodyScroll(false);
    releaseTrap(sideMenu);
    menuBtn.focus();
  }

  if(menuBtn && sideMenu){
    menuBtn.addEventListener('click', (e)=>{ e.preventDefault(); if(sideMenu.classList.contains('open')) closeMenuFn(); else openMenu(); });
  }
  closeMenu && closeMenu.addEventListener('click', (e)=>{ e.preventDefault(); closeMenuFn(); });
  menuOverlay && menuOverlay.addEventListener('click', (e)=>{ e.preventDefault(); closeMenuFn(); });
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && sideMenu.classList.contains('open')) closeMenuFn(); });

  collapsibles.forEach(btn => {
    const next = btn.nextElementSibling;
    if(next) next.style.display = 'none';
    btn.setAttribute('role','button');
    btn.addEventListener('click', ()=> {
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!expanded));
      if(next){ if(expanded){ next.classList.remove('expanded'); setTimeout(()=> next.style.display = 'none', 320); } else { next.style.display = 'block'; requestAnimationFrame(()=> next.classList.add('expanded')); } }
    });
  });

  menuLinks.forEach(a=>{
    a.addEventListener('click', (ev)=>{
      menuLinks.forEach(x => x.classList.remove('active'));
      a.classList.add('active');
      a.classList.add('press');
      setTimeout(()=> a.classList.remove('press'), 260);
      if(window.innerWidth < 900) closeMenuFn();
    });
    a.addEventListener('touchstart', ()=> a.classList.add('press'), {passive:true});
    a.addEventListener('touchend', ()=> a.classList.remove('press'));
    a.addEventListener('mousedown', ()=> a.classList.add('press'));
    a.addEventListener('mouseup', ()=> a.classList.remove('press'));
    a.addEventListener('mouseleave', ()=> a.classList.remove('press'));
  });

  // theme toggle persistence
  const themeToggle = document.getElementById('themeToggle');
  if(themeToggle){
    themeToggle.addEventListener('change', ()=>{ document.body.setAttribute('data-theme', themeToggle.value === 'dark' ? 'dark' : 'light'); localStorage.setItem('compcalc_theme', themeToggle.value); });
    const savedTheme = localStorage.getItem('compcalc_theme'); if(savedTheme) themeToggle.value = savedTheme;
    document.body.setAttribute('data-theme', themeToggle && themeToggle.value === 'dark' ? 'dark' : 'light');
  }

})();
</script>
</body>
</html>
